import{r as h,aK as S,aL as O,aM as z,aN as B,m as H,f as ut,aO as pt,S as te,aP as J,b as ft,R as ht,j as t,c as mt,U as xt,V as vt,X as yt,aQ as gt,Z as Ft,$ as N,h as _t,am as bt,A as T,aR as Me,s as ie,aS as jt,P as $e,aT as ke,aU as Re,aV as St,J as wt,aW as M,aX as $,aa as Ae,a4 as Ct,I as R,N as re,k as It,aY as V,aZ as Et,K as Oe,aw as se,a_ as ze,a$ as Ue,b0 as Be,aF as Ve,y as Pt,O as ce,n as Tt,p as Dt,q as Lt,b1 as Mt,b2 as $t,b3 as kt,_ as Rt,L as At,b4 as Ot,b5 as zt,b6 as Ut,b7 as Bt,z as Ee,b8 as Vt,b9 as Nt,ba as Ht,bb as qt,bc as Gt}from"./vendor-oJTxWfXc.js";import{i as Wt,g as oe,b as ae,c as q,d as Qt,e as Ne,u as le,a as fe,h as X,f as Y,n as ne,p as A,j as Kt,k as He,l as qe,m as Ge,o as Xt,z as Yt,q as Zt,r as Jt}from"./index-C6mBHpiU.js";const er=()=>{const[e,c]=h.useState(!0);h.useEffect(()=>{c(!1)},[]);const i=e||typeof navigator>"u";return{isMobile:h.useMemo(()=>!i&&Wt(),[i])}};var We={};(function(e){Object.defineProperty(e,"__esModule",{value:!0});var c="fas",i="arrows-rotate",d=512,l=512,p=[128472,"refresh","sync"],f="f021",r="M105.1 202.6c7.7-21.8 20.2-42.3 37.8-59.8c62.5-62.5 163.8-62.5 226.3 0L386.3 160H352c-17.7 0-32 14.3-32 32s14.3 32 32 32H463.5c0 0 0 0 0 0h.4c17.7 0 32-14.3 32-32V80c0-17.7-14.3-32-32-32s-32 14.3-32 32v35.2L414.4 97.6c-87.5-87.5-229.3-87.5-316.8 0C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5zM39 289.3c-5 1.5-9.8 4.2-13.7 8.2c-4 4-6.7 8.8-8.1 14c-.3 1.2-.6 2.5-.8 3.8c-.3 1.7-.4 3.4-.4 5.1V432c0 17.7 14.3 32 32 32s32-14.3 32-32V396.9l17.6 17.5 0 0c87.5 87.4 229.3 87.4 316.7 0c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.5 62.5-163.8 62.5-226.3 0l-.1-.1L125.6 352H160c17.7 0 32-14.3 32-32s-14.3-32-32-32H48.4c-1.6 0-3.2 .1-4.8 .3s-3.1 .5-4.6 1z";e.definition={prefix:c,iconName:i,icon:[d,l,p,f,r]},e.faArrowsRotate=e.definition,e.prefix=c,e.iconName=i,e.width=d,e.height=l,e.ligatures=p,e.unicode=f,e.svgPathData=r,e.aliases=p})(We);const tr=e=>e===te.ASC?te.DESC:te.ASC,Pe={[S.SortFilesByName.id]:"name",[S.SortFilesByDate.id]:"updatedAt",[S.SortFilesBySize.id]:"size"},I={DownloadFile:O({id:"download_file",requiresSelection:!0,fileFilter:e=>!(e&&"isDir"in e),button:{name:"Download",contextMenu:!0,icon:z.download}}),RenameFile:O({id:"rename_file",requiresSelection:!0,button:{name:"Rename",contextMenu:!0,icon:z.rename}}),DeleteFile:O({id:"delete_file",requiresSelection:!0,button:{name:"Delete",contextMenu:!0,icon:z.trash}}),SyncFiles:O({id:"sync_files",button:{name:"Sync Files",toolbar:!0,iconOnly:!0,icon:We.faArrowsRotate}}),OpenInVLCPlayer:O({id:"open_vlc_player",requiresSelection:!0,fileFilter:e=>!!(e&&oe(ae(e.name))==="video"&&!("isDir"in e)),button:{name:"Open In VLC",contextMenu:!0,icon:z.play}}),CopyDownloadLink:O({id:"copy_link",requiresSelection:!0,fileFilter:e=>!(e&&"isDir"in e),button:{name:"Copy Download Link",contextMenu:!0,icon:z.copy}}),CreateFolder:(e="",c="")=>O({id:"create_folder",button:{name:"Create folder",tooltip:"Create a folder",toolbar:!0,...e&&{group:e},icon:z.folderCreate},customVisibility:()=>c!=="my-drive"?B.Hidden:B.Default}),UploadFiles:(e="",c="")=>O({id:"upload_files",button:{name:"Upload files",tooltip:"Upload files",toolbar:!0,...e&&{group:e},icon:z.upload},customVisibility:()=>c!=="my-drive"?B.Hidden:B.Default}),GoToFolder:(e="")=>O({id:"go_to_folder",requiresSelection:!0,button:{name:"Go to folder",tooltip:"Go to folder",contextMenu:!0,icon:z.folder},customVisibility:()=>e!="my-drive"?B.Default:B.Hidden})},rr=(e,c,i)=>{const d=q(H()),{type:l,path:p}=d,f=ut(),r=pt("(max-width:600px)"),{preloadFiles:m}=Qt(),{sortFilter:o,setSortFilter:s}=Ne(),{settings:n}=le(),{data:a}=fe(),u=h.useMemo(()=>[I.GoToFolder(l),I.DownloadFile,I.RenameFile,I.DeleteFile,I.CopyDownloadLink,I.OpenInVLCPlayer,I.SyncFiles,I.CreateFolder(r?"Actions":"",l),I.UploadFiles(r?"Actions":"",l)],[r,l]),g=h.useCallback(()=>async y=>{switch(y.id){case S.OpenFiles.id:{const{targetFile:x,files:v}=y.payload,j=x??v[0];if(j&&J.isDirectory(j)&&m({type:"my-drive",path:j.path}),j&&j.type==="file"){const F=oe(ae(j.name));!J.isDirectory(j)&&F in A&&e({open:!0,file:j,operation:S.OpenFiles.id})}break}case"go_to_folder":{const{selectedFiles:x}=y.state,v=x[0];m({type:"my-drive",path:v.location});break}case I.DownloadFile.id:{const{selectedFiles:x}=y.state;for(const v of x)if(!J.isDirectory(v)){const{id:j,name:F}=v,w=Y(n.apiUrl,j,F,a==null?void 0:a.hash,!0);ne(w,!1)}break}case I.OpenInVLCPlayer.id:{const{selectedFiles:x}=y.state,v=x[0],{id:j,name:F}=v,w=`vlc://${Y(n.apiUrl,j,F,a==null?void 0:a.hash)}`;ne(w,!1);break}case I.RenameFile.id:{e({open:!0,file:y.state.selectedFiles[0],operation:I.RenameFile.id});break}case I.DeleteFile.id:{e({open:!0,selectedFiles:y.state.selectedFiles.map(x=>x.id),operation:I.DeleteFile.id});break}case S.CreateFolder.id:{e({open:!0,operation:S.CreateFolder.id});break}case S.UploadFiles.id:{c(),i();break}case I.CopyDownloadLink.id:{const x=y.state.selectedFilesForAction;let v="";x.forEach(j=>{if(!J.isDirectory(j)){const{id:F,name:w}=j;v=`${v}${Y(n.apiUrl,F,w,a==null?void 0:a.hash)}
`}}),navigator.clipboard.writeText(v);break}case S.MoveFiles.id:{const{files:x,destination:v}=y.payload;(await X.post("/api/files/move",{files:x.map(F=>F.id),destination:v.path?v.path:"/"})).status===200&&f.invalidateQueries({queryKey:["files"]});break}case S.SortFilesBySize.id:case S.SortFilesByDate.id:case S.SortFilesByName.id:{const x=o[l].sort!==Pe[y.id]?te.ASC:tr(o[l].order);s({...o,[l]:{sort:Pe[y.id],order:x}});break}case S.EnableGridView.id:{localStorage.setItem("view","grid");break}case S.EnableListView.id:{localStorage.setItem("view","list");break}case I.SyncFiles.id:{const x=["files",l,p,o[d.type].sort,o[d.type].order];f.invalidateQueries({queryKey:x});break}}},[[o[l],l]]);return{fileActions:u,chonkyActionHandler:g}};function K(){const c=ft().palette.onPrimaryContainer.main,i=ht.useRef(null);return h.useEffect(()=>{var d;return(d=i==null?void 0:i.current)==null||d.continuousStart(),()=>{var l;(l=i==null?void 0:i.current)==null||l.complete()}},[]),t.jsx(mt,{color:c,ref:i,waitingTime:200})}function or({modalState:e,setModalState:c}){const i=q(H()),{mutation:d}=Kt(i),l=h.useCallback((p=!0)=>{p?c(f=>({...f,open:!1})):(d.mutate({files:e.selectedFiles}),c(f=>({...f,open:!1,successful:!0})))},[]);return t.jsxs(xt,{open:e.open,onClose:()=>l(),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",PaperProps:{elevation:0},children:[t.jsx(vt,{id:"alert-dialog-title",children:"Delete Files"}),t.jsx(yt,{children:t.jsx(gt,{id:"alert-dialog-description",children:"Do you want to remove selected files?"})}),t.jsxs(Ft,{children:[t.jsx(N,{onClick:()=>l(),children:"No"}),t.jsx(N,{onClick:()=>l(!1),autoFocus:!0,children:"Yes"})]})]})}const ar=({error:e})=>{var d;const c=e,i=_t();return t.jsx(bt,{maxWidth:"md",style:{textAlign:"center",marginTop:"20vh"},children:t.jsxs(T,{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",children:[t.jsx(Me,{sx:{fontSize:100,color:"red"}}),t.jsx(ie,{variant:"h4",gutterBottom:!0,children:((d=c.response)==null?void 0:d.data.error)||e.message}),t.jsx(N,{variant:"contained",color:"primary",title:"Go to main directory",onClick:()=>{i("/my-drive",{replace:!0})},children:"Go to main directory"})]})})},nr=jt($e)({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,display:"flex",flexDirection:"column",gap:"1rem",padding:24,"@media (max-width: 480px)":{width:300}}),ir=h.memo(function({modalState:c,setModalState:i}){const d=h.useCallback(()=>i(a=>({...a,open:!1})),[]),l=q(H()),{path:p}=l,{mutation:f}=He(l),{mutation:r}=qe(l),{file:m,open:o,operation:s}=c,n=h.useCallback(()=>{s===I.RenameFile.id&&f.mutate({id:m==null?void 0:m.id,payload:{name:m==null?void 0:m.name,type:m==null?void 0:m.type}}),s===S.CreateFolder.id&&r.mutate({payload:{name:m==null?void 0:m.name,type:"folder",path:p||"/"}}),d()},[m,s,f,d,r]);return t.jsx(ke,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:!!o,onClose:d,closeAfterTransition:!0,slots:{backdrop:Re},slotProps:{backdrop:{timeout:500}},children:t.jsx(St,{in:o,children:t.jsxs(nr,{elevation:3,children:[t.jsxs(ie,{id:"transition-modal-title",variant:"h6",component:"h2",children:[s===I.RenameFile.id&&"Rename",s===S.CreateFolder.id&&S.CreateFolder.button.name]}),t.jsx(wt,{fullWidth:!0,focused:!0,value:m==null?void 0:m.name,variant:"outlined",inputProps:{autoComplete:"off"},onChange:a=>i(u=>({...u,file:{...u.file,name:a.target.value}}))}),t.jsxs(T,{sx:{display:"inline-flex",justifyContent:"flex-end",gap:"1.2rem"},children:[t.jsx(N,{sx:{fontWeight:"normal"},variant:"text",onClick:d,disableElevation:!0,children:"Cancel"}),t.jsx(N,{disabled:!(m!=null&&m.name),sx:{fontWeight:"normal"},variant:"contained",onClick:n,disableElevation:!0,children:"OK"})]})]})})})});var he={},sr=$;Object.defineProperty(he,"__esModule",{value:!0});var Qe=he.default=void 0,lr=sr(M()),cr=t;Qe=he.default=(0,lr.default)((0,cr.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");var me={},dr=$;Object.defineProperty(me,"__esModule",{value:!0});var Ke=me.default=void 0,ur=dr(M()),pr=t;Ke=me.default=(0,ur.default)((0,pr.jsx)("path",{d:"M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3zm-1-4-1.41-1.41L13 12.17V4h-2v8.17L8.41 9.59 7 11l5 5z"}),"FileDownloadOutlined");var xe={},fr=$;Object.defineProperty(xe,"__esModule",{value:!0});var Xe=xe.default=void 0,hr=fr(M()),mr=t;Xe=xe.default=(0,hr.default)((0,mr.jsx)("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"NavigateBefore");var ve={},xr=$;Object.defineProperty(ve,"__esModule",{value:!0});var Ye=ve.default=void 0,vr=xr(M()),yr=t;Ye=ve.default=(0,vr.default)((0,yr.jsx)("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"NavigateNext");var ye={},gr=$;Object.defineProperty(ye,"__esModule",{value:!0});var Ze=ye.default=void 0,Fr=gr(M()),_r=t;Ze=ye.default=(0,Fr.default)((0,_r.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVertOutlined");var ge={},br=$;Object.defineProperty(ge,"__esModule",{value:!0});var Je=ge.default=void 0,jr=br(M()),Sr=t;Je=ge.default=(0,jr.default)((0,Sr.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"}),"OpenInNew");var Fe={},wr=$;Object.defineProperty(Fe,"__esModule",{value:!0});var et=Fe.default=void 0,Cr=wr(M()),Ir=t;et=Fe.default=(0,Cr.default)((0,Ir.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star");const tt=Ae(e=>t.jsx(Ct,{elevation:0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},...e}))(({theme:e})=>({"& .MuiPaper-root":{borderRadius:6,marginTop:e.spacing(1),minWidth:180,color:"#E3E3E3",backgroundColor:"#121212",boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px","& .MuiMenu-list":{padding:"4px 0"},"& .MuiMenuItem-root":{"& .MuiSvgIcon-root":{fontSize:18,color:"#E3E3E3",marginRight:e.spacing(1.5)},"&:active":{backgroundColor:"rgba(255, 255, 255, 0.08)"},"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.08)"}}}}));function Er({starred:e,toggleStarred:c}){const[i,d]=h.useState(null),l=!!i,p=r=>{d(r.currentTarget)},f=()=>{d(null)};return t.jsxs(t.Fragment,{children:[t.jsx(R,{color:"inherit",edge:"start","aria-controls":l?"controls-menu":void 0,"aria-haspopup":"true","aria-expanded":l?"true":void 0,onClick:p,children:t.jsx(Ze,{})}),t.jsxs(tt,{id:"controls-menu",MenuListProps:{"aria-labelledby":"menu-button"},anchorEl:i,open:l,onClose:f,children:[t.jsxs(re,{onClick:c,disableRipple:!0,children:[e?t.jsx(et,{}):t.jsx(It,{}),e?"UnStarred":"Starred"]}),t.jsxs(re,{disableRipple:!0,children:[t.jsx(Je,{}),"Open in New Tab"]})]})]})}var _e={},Pr=$;Object.defineProperty(_e,"__esModule",{value:!0});var de=_e.default=void 0,Tr=Pr(M()),Dr=t;de=_e.default=(0,Tr.default)((0,Dr.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm-1 4 6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2zm-1 7h5.5L14 6.5z"}),"FileCopy");var be={},Lr=$;Object.defineProperty(be,"__esModule",{value:!0});var rt=be.default=void 0,Mr=Lr(M()),$r=t;rt=be.default=(0,Mr.default)((0,$r.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown");function kr({previewType:e,videoUrl:c}){const[i,d]=h.useState(null),l=!!i,p=r=>{d(r.currentTarget)},f=()=>{d(null)};return t.jsxs(t.Fragment,{children:[t.jsx(N,{id:"demo-customized-button","aria-controls":l?"demo-customized-menu":void 0,"aria-haspopup":"true","aria-expanded":l?"true":void 0,variant:"outlined",disableElevation:!0,onClick:p,endIcon:t.jsx(rt,{}),sx:{background:V("#121212",.75),border:`2px solid ${V("#FFFFFF",.52)} !important`,color:"#C4C7C5","&:hover":{background:V("#121212",.45)},"&:focus":{background:V("#121212",.45)},"&:active":{background:V("#121212",.45)}},children:"Open With"}),t.jsx(tt,{id:"demo-customized-menu",MenuListProps:{"aria-labelledby":"demo-customized-button"},anchorEl:i,open:l,onClose:f,children:e===A.video&&t.jsxs(T,{children:[t.jsxs(re,{onClick:()=>{ne(`vlc://${c}`,!1),f()},disableRipple:!0,children:[t.jsx(de,{}),"Open In VLC"]}),t.jsxs(re,{onClick:()=>{ne(`potplayer://${c}`,!1),f()},disableRipple:!0,children:[t.jsx(de,{}),"Open In PotPlayer"]})]})})]})}const Rr=({mediaUrl:e})=>{const c=`https://view.officeapps.live.com/op/view.aspx?src=${e}`;return t.jsx(T,{component:"iframe",title:"DocView",sx:{position:"relative",border:"none",zIndex:101},src:c,width:"100%",height:"100%",allowFullScreen:!0})},Ar=h.memo(Rr);var je={},Or=$;Object.defineProperty(je,"__esModule",{value:!0});var ot=je.default=void 0,zr=Or(M()),Ur=t;ot=je.default=(0,zr.default)((0,Ur.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen");var Se={},Br=$;Object.defineProperty(Se,"__esModule",{value:!0});var at=Se.default=void 0,Vr=Br(M()),Nr=t;at=Se.default=(0,Vr.default)((0,Nr.jsx)("path",{d:"M5 16h3v3h2v-5H5zm3-8H5v2h5V5H8zm6 11h2v-3h3v-2h-5zm2-11V5h-2v5h5V8z"}),"FullscreenExit");const Hr=({children:e})=>{const[c,i]=Et(!1);return t.jsx(T,{sx:{maxWidth:"70%",width:"100%",margin:"auto",padding:"1rem",position:"relative",height:"90vh"},children:t.jsxs(T,{sx:{width:"100%",height:"100%",...c&&{position:"fixed",top:0,left:0}},children:[t.jsx(R,{sx:{position:"absolute",bottom:"1.2rem",right:"1.2rem",background:"#1F1F1F",zIndex:102},color:"inherit",edge:"start",onClick:i,children:c?t.jsx(at,{}):t.jsx(ot,{})}),e]})})},ee=h.memo(Hr),qr=({name:e,mediaUrl:c})=>{const[i,d]=h.useState(!1),l=()=>{d(!0)};return t.jsxs(T,{sx:{maxWidth:"64rem",maxHeight:"calc(100vh - 4rem)",margin:"auto",padding:"1rem",position:"relative"},children:[!i&&t.jsx(Oe,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}),t.jsx(T,{onLoad:l,component:"img",src:c,alt:e,sx:{maxWidth:"100%",maxHeight:"100%",opacity:i?1:0,transition:"opacity 300ms ease",objectFit:"contain"}})]})},Gr=h.memo(qr),Wr=({mediaUrl:e})=>{const c=`https://alist-org.github.io/pdf.js/web/viewer.html?file=${e}`;return t.jsx(T,{component:"iframe",title:"PdfView",sx:{position:"relative",border:"none",zIndex:101},src:c,width:"100%",height:"100%",allowFullScreen:!0})},Qr=h.memo(Wr),Kr=h.lazy(()=>se(()=>import("./VideoPreview-NSHGSfD5.js"),__vite__mapDeps([0,1,2]))),Xr=h.lazy(()=>se(()=>import("./CodePreview-VuWmkklv.js"),__vite__mapDeps([3,1,4,5]))),Yr=h.lazy(()=>se(()=>import("./EpubPreview-u5yCtLq2.js"),__vite__mapDeps([6,1,2]))),Zr=h.lazy(()=>se(()=>import("./AudioPreview-NI8FeiEj.js"),__vite__mapDeps([7,1,4,5]))),Jr=h.memo(function({modalState:c,setModalState:i}){const{settings:d}=le(),[l,p]=h.useState(-1),f=q(H()),{data:r}=Ge(f),{data:m}=fe(),o=h.useMemo(()=>{var L;const b=(L=r==null?void 0:r.pages)==null?void 0:L.flatMap(k=>(k==null?void 0:k.results)??[]);return b==null?void 0:b.reduce((k,G,W)=>{const{id:Q,name:Z,starred:E,mimeType:P}=G,U=oe(ae(Z));return U&&k.push({id:Q,name:Z,mimeType:P,previewType:U,starred:E}),k},[])},[r]);h.useEffect(()=>p(o.findIndex(b=>{var L;return b.id===((L=c.file)==null?void 0:L.id)})),[]);const{id:s,name:n,starred:a,mimeType:u}=l>=0?o==null?void 0:o[l]:{id:"",name:"",starred:!1,mimeType:""},{icon:g,colorCode:y}=ze({id:s,name:n,isDir:!1}),x=Y(d.apiUrl,s,n,m==null?void 0:m.hash),v=h.useCallback(()=>{let b=l+1;b>=(o==null?void 0:o.length)&&(b=0),p(b)},[l]),j=h.useCallback(()=>{let b=l-1;b<0&&(b=(o==null?void 0:o.length)-1),p(b)},[l]),F=h.useCallback(()=>i(b=>({...b,open:!1})),[]),{mutation:w}=He(f),D=h.useCallback(()=>{w.mutate({id:s,payload:{starred:!a}})},[s,a,w]),C=h.useMemo(()=>n?oe(ae(n),{video:u.includes("video")}):"",[u,n]),_=h.useCallback(()=>{if(C)switch(C){case A.video:return t.jsx(h.Suspense,{fallback:t.jsx(K,{}),children:t.jsx(Kr,{name:n,mediaUrl:x})});case A.pdf:return t.jsx(ee,{children:t.jsx(Qr,{mediaUrl:x})});case A.office:return t.jsx(ee,{children:t.jsx(Ar,{mediaUrl:x})});case A.code:return t.jsx(h.Suspense,{fallback:t.jsx(K,{}),children:t.jsx(ee,{children:t.jsx(Xr,{name:n,mediaUrl:x})})});case A.image:return t.jsx(Gr,{name:n,mediaUrl:x});case A.epub:return t.jsx(h.Suspense,{fallback:t.jsx(K,{}),children:t.jsx(ee,{children:t.jsx(Yr,{mediaUrl:x})})});case A.audio:return t.jsx(h.Suspense,{fallback:t.jsx(K,{}),children:t.jsx(Zr,{setCurrIndex:p,currIndex:l,previews:o,name:n,mediaUrl:x})});default:return null}},[x,n,C]);return t.jsx(ke,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:c.open,sx:{display:"flex",overflowY:"auto",flexDirection:"column",gap:"3rem",overflow:"hidden"},onClose:F,closeAfterTransition:!0,slots:{backdrop:Re},slotProps:{backdrop:{timeout:500,sx:{bgcolor:b=>V(b.palette.shadow.main,.7)}}},children:t.jsx(t.Fragment,{children:s&&n&&t.jsxs(t.Fragment,{children:[t.jsx(R,{sx:{position:"absolute",left:32,color:"white",top:"50%",background:"#1F1F1F"},color:"inherit",edge:"start",onClick:j,children:t.jsx(Xe,{})}),t.jsx(R,{sx:{position:"absolute",right:32,color:"white",top:"50%",background:"#1F1F1F"},color:"inherit",edge:"start",onClick:v,children:t.jsx(Ye,{})}),t.jsxs(T,{sx:{position:"absolute",height:64,width:"100%",top:0,padding:2,color:"white",display:"flex",justifyContent:"space-between"},children:[t.jsxs(T,{sx:{display:"inline-flex",alignItems:"center",gap:"0.5rem",width:"30%",position:"absolute",left:"1rem"},children:[t.jsx(R,{color:"inherit",edge:"start",onClick:F,children:t.jsx(Qe,{})}),t.jsx(Ue,{icon:g,style:{color:Be[y]}}),t.jsx(ie,{sx:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",fontSize:"1rem",cursor:"pointer"},variant:"h6",component:"h6",title:n,children:n})]}),C===A.video&&t.jsx(T,{sx:{position:"absolute",top:"50%",left:"50%",marginRight:"-50%",transform:"translate(-50%,-50%)"},children:t.jsx(kr,{videoUrl:`${x}`,previewType:C})}),t.jsxs(T,{sx:{display:"inline-flex",alignItems:"center",gap:"1rem",position:"absolute",right:"1rem"},children:[t.jsx(R,{component:"a",rel:"noopener noreferrer",href:`${x}&d=1`,color:"inherit",edge:"start",children:t.jsx(Ke,{})}),t.jsx(Er,{starred:a,toggleStarred:D})]})]}),_()]})})})});var we={},eo=$;Object.defineProperty(we,"__esModule",{value:!0});var nt=we.default=void 0,to=eo(M()),ro=t;nt=we.default=(0,to.default)((0,ro.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var Ce={},oo=$;Object.defineProperty(Ce,"__esModule",{value:!0});var it=Ce.default=void 0,ao=oo(M()),no=t;it=Ce.default=(0,ao.default)((0,no.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var Ie={},io=$;Object.defineProperty(Ie,"__esModule",{value:!0});var st=Ie.default=void 0,so=io(M()),lo=t;st=Ie.default=(0,so.default)((0,lo.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");var lt={exports:{}},ct={exports:{}};(function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c={rotl:function(i,d){return i<<d|i>>>32-d},rotr:function(i,d){return i<<32-d|i>>>d},endian:function(i){if(i.constructor==Number)return c.rotl(i,8)&16711935|c.rotl(i,24)&4278255360;for(var d=0;d<i.length;d++)i[d]=c.endian(i[d]);return i},randomBytes:function(i){for(var d=[];i>0;i--)d.push(Math.floor(Math.random()*256));return d},bytesToWords:function(i){for(var d=[],l=0,p=0;l<i.length;l++,p+=8)d[p>>>5]|=i[l]<<24-p%32;return d},wordsToBytes:function(i){for(var d=[],l=0;l<i.length*32;l+=8)d.push(i[l>>>5]>>>24-l%32&255);return d},bytesToHex:function(i){for(var d=[],l=0;l<i.length;l++)d.push((i[l]>>>4).toString(16)),d.push((i[l]&15).toString(16));return d.join("")},hexToBytes:function(i){for(var d=[],l=0;l<i.length;l+=2)d.push(parseInt(i.substr(l,2),16));return d},bytesToBase64:function(i){for(var d=[],l=0;l<i.length;l+=3)for(var p=i[l]<<16|i[l+1]<<8|i[l+2],f=0;f<4;f++)l*8+f*6<=i.length*8?d.push(e.charAt(p>>>6*(3-f)&63)):d.push("=");return d.join("")},base64ToBytes:function(i){i=i.replace(/[^A-Z0-9+\/]/ig,"");for(var d=[],l=0,p=0;l<i.length;p=++l%4)p!=0&&d.push((e.indexOf(i.charAt(l-1))&Math.pow(2,-2*p+8)-1)<<p*2|e.indexOf(i.charAt(l))>>>6-p*2);return d}};ct.exports=c})();var co=ct.exports,ue={utf8:{stringToBytes:function(e){return ue.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(ue.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var c=[],i=0;i<e.length;i++)c.push(e.charCodeAt(i)&255);return c},bytesToString:function(e){for(var c=[],i=0;i<e.length;i++)c.push(String.fromCharCode(e[i]));return c.join("")}}},Te=ue;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var uo=function(e){return e!=null&&(dt(e)||po(e)||!!e._isBuffer)};function dt(e){return!!e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function po(e){return typeof e.readFloatLE=="function"&&typeof e.slice=="function"&&dt(e.slice(0,0))}(function(){var e=co,c=Te.utf8,i=uo,d=Te.bin,l=function(p,f){p.constructor==String?f&&f.encoding==="binary"?p=d.stringToBytes(p):p=c.stringToBytes(p):i(p)?p=Array.prototype.slice.call(p,0):!Array.isArray(p)&&p.constructor!==Uint8Array&&(p=p.toString());for(var r=e.bytesToWords(p),m=p.length*8,o=1732584193,s=-271733879,n=-1732584194,a=271733878,u=0;u<r.length;u++)r[u]=(r[u]<<8|r[u]>>>24)&16711935|(r[u]<<24|r[u]>>>8)&4278255360;r[m>>>5]|=128<<m%32,r[(m+64>>>9<<4)+14]=m;for(var g=l._ff,y=l._gg,x=l._hh,v=l._ii,u=0;u<r.length;u+=16){var j=o,F=s,w=n,D=a;o=g(o,s,n,a,r[u+0],7,-680876936),a=g(a,o,s,n,r[u+1],12,-389564586),n=g(n,a,o,s,r[u+2],17,606105819),s=g(s,n,a,o,r[u+3],22,-1044525330),o=g(o,s,n,a,r[u+4],7,-176418897),a=g(a,o,s,n,r[u+5],12,1200080426),n=g(n,a,o,s,r[u+6],17,-1473231341),s=g(s,n,a,o,r[u+7],22,-45705983),o=g(o,s,n,a,r[u+8],7,1770035416),a=g(a,o,s,n,r[u+9],12,-1958414417),n=g(n,a,o,s,r[u+10],17,-42063),s=g(s,n,a,o,r[u+11],22,-1990404162),o=g(o,s,n,a,r[u+12],7,1804603682),a=g(a,o,s,n,r[u+13],12,-40341101),n=g(n,a,o,s,r[u+14],17,-1502002290),s=g(s,n,a,o,r[u+15],22,1236535329),o=y(o,s,n,a,r[u+1],5,-165796510),a=y(a,o,s,n,r[u+6],9,-1069501632),n=y(n,a,o,s,r[u+11],14,643717713),s=y(s,n,a,o,r[u+0],20,-373897302),o=y(o,s,n,a,r[u+5],5,-701558691),a=y(a,o,s,n,r[u+10],9,38016083),n=y(n,a,o,s,r[u+15],14,-660478335),s=y(s,n,a,o,r[u+4],20,-405537848),o=y(o,s,n,a,r[u+9],5,568446438),a=y(a,o,s,n,r[u+14],9,-1019803690),n=y(n,a,o,s,r[u+3],14,-187363961),s=y(s,n,a,o,r[u+8],20,1163531501),o=y(o,s,n,a,r[u+13],5,-1444681467),a=y(a,o,s,n,r[u+2],9,-51403784),n=y(n,a,o,s,r[u+7],14,1735328473),s=y(s,n,a,o,r[u+12],20,-1926607734),o=x(o,s,n,a,r[u+5],4,-378558),a=x(a,o,s,n,r[u+8],11,-2022574463),n=x(n,a,o,s,r[u+11],16,1839030562),s=x(s,n,a,o,r[u+14],23,-35309556),o=x(o,s,n,a,r[u+1],4,-1530992060),a=x(a,o,s,n,r[u+4],11,1272893353),n=x(n,a,o,s,r[u+7],16,-155497632),s=x(s,n,a,o,r[u+10],23,-1094730640),o=x(o,s,n,a,r[u+13],4,681279174),a=x(a,o,s,n,r[u+0],11,-358537222),n=x(n,a,o,s,r[u+3],16,-722521979),s=x(s,n,a,o,r[u+6],23,76029189),o=x(o,s,n,a,r[u+9],4,-640364487),a=x(a,o,s,n,r[u+12],11,-421815835),n=x(n,a,o,s,r[u+15],16,530742520),s=x(s,n,a,o,r[u+2],23,-995338651),o=v(o,s,n,a,r[u+0],6,-198630844),a=v(a,o,s,n,r[u+7],10,1126891415),n=v(n,a,o,s,r[u+14],15,-1416354905),s=v(s,n,a,o,r[u+5],21,-57434055),o=v(o,s,n,a,r[u+12],6,1700485571),a=v(a,o,s,n,r[u+3],10,-1894986606),n=v(n,a,o,s,r[u+10],15,-1051523),s=v(s,n,a,o,r[u+1],21,-2054922799),o=v(o,s,n,a,r[u+8],6,1873313359),a=v(a,o,s,n,r[u+15],10,-30611744),n=v(n,a,o,s,r[u+6],15,-1560198380),s=v(s,n,a,o,r[u+13],21,1309151649),o=v(o,s,n,a,r[u+4],6,-145523070),a=v(a,o,s,n,r[u+11],10,-1120210379),n=v(n,a,o,s,r[u+2],15,718787259),s=v(s,n,a,o,r[u+9],21,-343485551),o=o+j>>>0,s=s+F>>>0,n=n+w>>>0,a=a+D>>>0}return e.endian([o,s,n,a])};l._ff=function(p,f,r,m,o,s,n){var a=p+(f&r|~f&m)+(o>>>0)+n;return(a<<s|a>>>32-s)+f},l._gg=function(p,f,r,m,o,s,n){var a=p+(f&m|r&~m)+(o>>>0)+n;return(a<<s|a>>>32-s)+f},l._hh=function(p,f,r,m,o,s,n){var a=p+(f^r^m)+(o>>>0)+n;return(a<<s|a>>>32-s)+f},l._ii=function(p,f,r,m,o,s,n){var a=p+(r^(f|~m))+(o>>>0)+n;return(a<<s|a>>>32-s)+f},l._blocksize=16,l._digestsize=16,lt.exports=function(p,f){if(p==null)throw new Error("Illegal argument "+p);var r=e.wordsToBytes(l(p,f));return f&&f.asBytes?r:f&&f.asString?d.bytesToString(r):e.bytesToHex(r)}})();var fo=lt.exports;const ho=Ve(fo);class mo{constructor(c){this.value=c,this.next=void 0}}let xo=class{constructor(){this.clear()}enqueue(c){const i=new mo(c);this._head?(this._tail.next=i,this._tail=i):(this._head=i,this._tail=i),this._size++}dequeue(){const c=this._head;if(c)return this._head=this._head.next,this._size--,c.value}clear(){this._head=void 0,this._tail=void 0,this._size=0}get size(){return this._size}*[Symbol.iterator](){let c=this._head;for(;c;)yield c.value,c=c.next}};var vo=xo;const yo=vo,go=e=>{if(!((Number.isInteger(e)||e===1/0)&&e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const c=new yo;let i=0;const d=()=>{i--,c.size>0&&c.dequeue()()},l=async(r,m,...o)=>{i++;const s=(async()=>r(...o))();m(s);try{await s}catch{}d()},p=(r,m,...o)=>{c.enqueue(l.bind(null,r,m,...o)),(async()=>(await Promise.resolve(),i<e&&c.size>0&&c.dequeue()()))()},f=(r,...m)=>new Promise(o=>{p(r,o,...m)});return Object.defineProperties(f,{activeCount:{get:()=>i},pendingCount:{get:()=>c.size},clearQueue:{value:()=>{c.clear()}}}),f};var Fo=go;const _o=Ve(Fo);function bo(){const[e,c]=h.useState(!1),i=h.useRef(null),d=()=>c(!0),l=()=>c(!1);return h.useEffect(()=>{const p=i.current;if(p)return p.addEventListener("mouseover",d),p.addEventListener("mouseout",l),()=>{p.removeEventListener("mouseover",d),p.removeEventListener("mouseout",l)}},[i.current]),[i,e]}const jo={files:[],currentFileIndex:0,fileuploadProgress:[],collapse:!0,visibility:!1,fileUploadStates:[],fileAbortControllers:[]},So=(e,c)=>{switch(c.type){case"SET_FILES":return{...e,files:c.payload,fileUploadStates:c.payload.map(()=>0),fileAbortControllers:c.payload.map(()=>new AbortController),fileuploadProgress:c.payload.map(()=>0)};case"ADD_FILES":const i=c.payload.map(()=>0),d=c.payload.map(()=>new AbortController),l=c.payload.map(()=>0);return{...e,files:[...e.files,...c.payload],fileUploadStates:[...e.fileUploadStates,...i],fileAbortControllers:[...e.fileAbortControllers,...d],fileuploadProgress:[...e.fileuploadProgress,...l]};case"SET_UPLOAD_PROGRESS":const p=[...e.fileuploadProgress];return p[c.payload.fileIndex]=c.payload.progress,{...e,fileuploadProgress:p};case"SET_CURRENT_FILE_INDEX":return{...e,currentFileIndex:c.payload};case"TOGGLE_COLLAPSE":return{...e,collapse:!e.collapse};case"SET_VISIBILITY":return{...e,visibility:c.payload};case"SET_FILE_UPLOAD_STATUS":const f=[...e.fileUploadStates];return f[c.payload.fileIndex]=c.payload.status,{...e,fileUploadStates:f};default:return e}},wo=h.memo(({index:e,name:c,progress:i,size:d,uploadState:l,handleCancel:p})=>{const{icon:f,colorCode:r}=ze({name:c,isDir:!1,id:""}),[m,o]=bo(),s=Pt(),n=h.useMemo(()=>l===1?`${ce.formatFileSize(s,{size:i/100*d})}/${ce.formatFileSize(s,{size:d})}`:l===2?`${ce.formatFileSize(s,{size:d})}`:"",[i,d,l]);return t.jsxs(Tt,{ref:m,children:[t.jsx(Dt,{children:t.jsx(Ue,{icon:f,style:{color:Be[r]}})}),t.jsx(Lt,{title:c,primaryTypographyProps:{sx:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},primary:c,secondary:n}),o&&l===1?t.jsx(R,{sx:{color:"text.primary"},onClick:()=>p(e),children:t.jsx(Mt,{})}):t.jsxs(T,{sx:{height:40,width:40},children:[l===1&&t.jsx(T,{sx:{height:40,width:40,padding:1},children:t.jsx(Oe,{size:24,variant:"determinate",value:i})}),l===2&&t.jsx(R,{sx:{color:"green"},children:t.jsx($t,{})}),l===4&&t.jsx(R,{sx:{color:"red"},children:t.jsx(Me,{})}),l===3&&t.jsx(R,{sx:{color:"gray"},children:t.jsx(kt,{})})]})]})}),Co=async(e,c,i,d,l)=>(await X.post(e,c,{timeout:0,signal:l,params:i,onUploadProgress:f=>{const r=f.progress?f.progress:0;d(r*100)}})).data,Io=async(e,c,i,d,l,p)=>new Promise(async(f,r)=>{if((await X.get("/api/files",{params:{path:c,name:e.name,op:"find"}})).data.results.length>0){r(new Error("duplicate file change name"));return}const o=Math.ceil(e.size/d.splitFileSize),s=_o(Number(d.uploadConcurrency)),n=ho(c+"/"+e.name+e.size.toString()+Xt(e.lastModified)),a=`/api/uploads/${n}`,u=(await X.get(a)).data.parts;let g;u.length>0&&(g=u[0].channelId);let y=[];const x=[],v=[];for(let F=0;F<o;F++){if(u.findIndex(D=>D.partNo===F+1)>-1){y[F]=100;continue}const w=new AbortController;v.push(w),x.push(s(()=>(async()=>{const D=F*d.splitFileSize,C=Math.min(F*d.splitFileSize+d.splitFileSize,e.size),_=o>1?e.slice(D,C):e,L={partName:o>1?`${e.name}.part.${Yt(F+1,3)}`:e.name,fileName:e.name,partNo:F+1,encrypted:d.encryptFiles==="yes",channelId:g};return await Co(a,_,L,G=>{y[F]=G},w.signal)})()))}p.addEventListener("abort",()=>{v.forEach(F=>{F.abort()})});const j=setInterval(()=>{const F=y.reduce((w,D)=>w+D,0);l(F/o)},1e3);try{const F=await Promise.all(x),w=u.concat(F).sort((C,_)=>C.partNo-_.partNo).map(C=>({id:C.partId,salt:C.salt})),D={name:e.name,mimeType:e.type??"application/octet-stream",type:"file",parts:w,size:e.size,path:c||"/",encrypted:d.encryptFiles==="yes",channelId:g};await i.mutateAsync({payload:D}),await X.delete(`/api/uploads/${n}`),f(!0)}catch(F){r(F)}finally{clearInterval(j)}}),Eo=({hideUpload:e,fileDialogOpened:c,closeFileDialog:i})=>{const{settings:d}=le(),[l,p]=h.useReducer(So,jo),{files:f,currentFileIndex:r,fileuploadProgress:m,collapse:o,visibility:s,fileUploadStates:n,fileAbortControllers:a}=l,u=h.useRef(-1),g=h.useRef(null),y=h.useCallback(()=>{var _;(_=g==null?void 0:g.current)==null||_.click(),window.addEventListener("focus",()=>{var b,L;((L=(b=g.current)==null?void 0:b.files)==null?void 0:L.length)===0&&i()},{once:!0})},[]),x=h.useCallback(()=>{p({type:"TOGGLE_COLLAPSE"})},[p]),v=h.useCallback(()=>{r<f.length&&(a[r].signal.aborted||a[r].abort()),e()},[a,r]),j=h.useCallback(_=>{p({type:"SET_FILE_UPLOAD_STATUS",payload:{fileIndex:_,status:3}}),a[_].abort()},[a]);h.useEffect(()=>{c&&y()},[c]);const F=h.useCallback(_=>{const b=_.target.files,L=b?Array.from(b).filter(k=>k.size>0):[];L.length>0&&(p({type:"SET_VISIBILITY",payload:!0}),p({type:"ADD_FILES",payload:L}),i())},[]);h.useEffect(()=>{n[r]===3&&r<f.length&&p({type:"SET_CURRENT_FILE_INDEX",payload:r+1})},[n]);const w=q(H()),{path:D}=w,{mutation:C}=qe(w);return h.useEffect(()=>{f.length>0&&r<f.length&&u.current!==r&&(p({type:"SET_FILE_UPLOAD_STATUS",payload:{fileIndex:r,status:1}}),Io(f[r],D,C,d,_=>{p({type:"SET_UPLOAD_PROGRESS",payload:{fileIndex:r,progress:_}})},a[r].signal).then(()=>{p({type:"SET_UPLOAD_PROGRESS",payload:{fileIndex:r,progress:100}}),p({type:"SET_FILE_UPLOAD_STATUS",payload:{fileIndex:r,status:2}}),p({type:"SET_CURRENT_FILE_INDEX",payload:r+1}),a[r].abort()}).catch(_=>{_.name==="AbortError"?p({type:"SET_FILE_UPLOAD_STATUS",payload:{fileIndex:r,status:3}}):p({type:"SET_FILE_UPLOAD_STATUS",payload:{fileIndex:r,status:4}}),Rt.error(_.message)}),u.current=r)},[f,r]),t.jsxs(t.Fragment,{children:[t.jsx(T,{component:"input",ref:g,onChange:F,type:"file",sx:{display:"none"},multiple:!0}),s&&t.jsx(At,{sx:{width:"100%",maxWidth:360,position:"fixed",bottom:0,right:8,zIndex:_=>_.zIndex.drawer+1,"@media (max-width: 1024px)":{bottom:56},background:_=>_.palette.mode==="dark"?Ot(_.palette.background.paper,.08):zt(_.palette.background.paper,.02)},component:$e,subheader:t.jsxs(Ut,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(ie,{variant:"h6",component:"h6",children:`Uploading ${f.length} file`}),t.jsxs(T,{children:[t.jsx(R,{sx:{color:"text.primary"},onClick:x,children:o?t.jsx(it,{}):t.jsx(st,{})}),t.jsx(R,{sx:{color:"text.primary"},onClick:v,children:t.jsx(nt,{})})]})]}),children:t.jsx(Bt,{in:o,timeout:"auto",unmountOnExit:!0,sx:{maxHeight:200,overflow:"auto"},children:f.length>0&&f.map((_,b)=>t.jsx(wo,{index:b,name:_.name,size:_.size,uploadState:n[b],handleCancel:j,progress:m[b]},b))})})]})},De="MyFileBrowser",pe={root:`${De}-root`,progress:`${De}-progress`},Po=Ae("div",{})(({theme:e})=>({[`&.${pe.root}`]:{height:"100%",width:"100%",margin:"auto"},[`& .${pe.progress}`]:{margin:"auto",color:e.palette.text.primary,height:"30px !important",width:"30px !important"}}));let Le=!0;function To(e){return e.getState!==void 0}const Do={name:S.SortFilesByName.id,updatedAt:S.SortFilesByDate.id,size:S.SortFilesBySize.id},Lo={list:S.EnableListView.id,grid:S.EnableGridView.id},Mo=()=>{const e=h.useRef(new Map).current,c=q(H()),{type:i,path:d}=c,{value:l,setTrue:p,setFalse:f}=Ee(!1),{value:r,setTrue:m,setFalse:o}=Ee(!1),{isMobile:s}=er(),n=h.useRef(null),{sortFilter:a}=Ne(),u=h.useMemo(()=>{const E=a[i].order,P=Do[a[i].sort];return{defaultSortOrder:E,defaultSortActionId:P}},[i]),{data:g,error:y,fetchNextPage:x,hasNextPage:v,isFetchingNextPage:j,isLoading:F}=Ge(c),w=h.useMemo(()=>{var E;if(g)return(E=g==null?void 0:g.pages)==null?void 0:E.flatMap(P=>P!=null&&P.results?Zt(P==null?void 0:P.results):[])},[g]),D=h.useMemo(()=>{if(i==="my-drive")return Object.entries(Jt(d)).map(([E,P])=>({id:E,name:E,path:P,isDir:!0,chain:!0}))},[i,d]),[C,_]=h.useState({open:!1,operation:I.RenameFile.id}),{fileActions:b,chonkyActionHandler:L}=rr(_,p,m),{open:k}=C;if(h.useEffect(()=>{if(Le){Le=!1;return}return setTimeout(()=>{var E,P;(P=n.current)==null||P.scrollTo({top:((E=e.get(i+d))==null?void 0:E.scrollTop)??0,left:0})},0),()=>{var E;n.current&&To(n.current)&&((E=n.current)==null||E.getState(P=>e.set(i+d,P)))}},[i,d]),y)return t.jsx(ar,{error:y});const G=localStorage.getItem("view")||"list",{settings:W}=le(),{data:Q}=fe(),Z=h.useCallback(E=>{const P=Y(W.apiUrl,E.id,E.name,Q==null?void 0:Q.hash),U=new URL(P);return U.searchParams.set("w","360"),E.previewType==="image"?W.resizerHost?`${W.resizerHost}/${U.host}${U.pathname}${U.search}`:P:void 0},[W.resizerHost]);return t.jsxs(Po,{className:pe.root,children:[F&&i!=="search"&&t.jsx(K,{}),t.jsxs(Vt,{files:w,folderChain:D,onFileAction:L(),fileActions:b,disableDragAndDropProvider:!!s,defaultFileViewActionId:Lo[G],useStoreProvider:!0,useThemeProvider:!1,defaultSortActionId:u.defaultSortActionId,defaultSortOrder:u.defaultSortOrder,defaultFileViewEntryHeight:i!=="my-drive"?60:void 0,thumbnailGenerator:Z,children:[t.jsx(Nt,{}),t.jsx(Ht,{hideSearchBar:!0}),t.jsx(qt,{hasNextPage:v,isNextPageLoading:j,loadNextPage:x,ref:n}),t.jsx(Gt,{})]}),[I.RenameFile.id,S.CreateFolder.id].find(E=>E===C.operation)&&k&&t.jsx(ir,{modalState:C,setModalState:_}),C.operation===S.OpenFiles.id&&k&&t.jsx(Jr,{modalState:C,setModalState:_}),C.operation===I.DeleteFile.id&&k&&t.jsx(or,{modalState:C,setModalState:_}),l&&t.jsx(Eo,{fileDialogOpened:r,closeFileDialog:o,hideUpload:f})]})},$o=h.memo(Mo);function Oo(){return t.jsx($o,{})}export{Oo as FileBrowser};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/VideoPreview-NSHGSfD5.js","assets/vendor-oJTxWfXc.js","assets/_commonjs-dynamic-modules-h-SxKiO4.js","assets/CodePreview-VuWmkklv.js","assets/index-C6mBHpiU.js","assets/index-jJc08by7.css","assets/EpubPreview-u5yCtLq2.js","assets/AudioPreview-NI8FeiEj.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
